<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Real-time - v218.51 (Summary Detail Update)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            /* Vibrant but Soft Pastel Palette */
            --primary-accent: #0ABDE3;
            --secondary-accent: #FF9F43;
            --success-color: #00D2D3;
            --danger-color: #FF6B6B;
            --warning-color: #FECA57;

            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --text-on-dark: #FFFFFF;
            --text-muted: #636e72;
            /* Sync with LK */

            /* Glassmorphism Variables */
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: #546e7a;
            /* Dark Visible Gray-Blue */
            --border-main: #2d3436;
            /* Unified Dark Border */

            /* Claymorphism/Floating Effect - Refined */
            --clay-shadow:
                20px 20px 60px #cadbe6,
                -20px -20px 60px #ffffff;

            --card-radius: 20px;
            --shadow-main: var(--clay-shadow);
            --bg-main: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%) no-repeat fixed;
        }

        /* Y√äU C·∫¶U 1: ·∫®n c√°c n√∫t li√™n quan ƒë·∫øn ch·ªçn ng√†nh h√†ng khi ch·ª•p m√†n h√¨nh */
        .capture-mode .card,
        .capture-mode .input-section,
        .capture-mode .action-btn,
        .capture-mode .sub-kpi-card {
            box-shadow: none !important;
            transform: none !important;
            transition: none !important;
        }

        .capture-mode #contestCategoryFilterControls,
        .capture-mode .details-toggle {
            display: none !important;
        }

        html,
        body {
            width: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            /* White-Gray Tone */
            background-color: #f5f7fa;
            background-image: linear-gradient(to bottom, #ffffff, #eaeff2);
            min-height: 100vh;
            /* Changed Font to Tahoma as requested for better Vietnamese support */
            font-family: 'Tahoma', 'Arial', sans-serif;
            color: var(--text-primary);
        }

        .container {
            width: 100%;
            max-width: 100%;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        header {
            text-align: center;
            margin-bottom: 10px;
        }

        header h1 {
            color: var(--text-primary);
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        /* Glassmorphism Card Style */
        .input-section,
        .card,
        .sub-kpi-card,
        .chart-wrapper {
            background: var(--glass-bg);
            padding: 24px;
            border-radius: 20px;
            box-shadow: var(--clay-shadow);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-main);
            /* Uniform dark border like Contest Cards */
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .card:hover,
        .sub-kpi-card:hover {
            transform: translateY(-5px) scale(1.005);
            box-shadow: 0 15px 45px 0 rgba(31, 38, 135, 0.15);
        }

        .input-section h4 {
            margin-top: 0;
            color: var(--text-muted);
            font-size: 0.95em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .input-section h4 a {
            color: inherit;
            text-decoration: none;
            transition: color 0.2s;
        }

        .input-section h4 a:hover {
            color: var(--primary-accent);
        }

        textarea {
            width: 100%;
            padding: 12px;
            background: rgba(236, 240, 243, 0.6);
            border-radius: 16px;
            font-size: 14px;
            box-sizing: border-box;
            resize: vertical;
            transition: all 0.3s ease;
            /* Deep Clay Inset Shadow */
            box-shadow: inset 6px 6px 10px rgba(163, 177, 198, 0.3), inset -6px -6px 10px rgba(255, 255, 255, 0.8);
            border: none;
        }

        textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: inset 1px 1px 3px rgba(0, 0, 0, 0.05), 0 0 0 3px rgba(10, 189, 227, 0.2);
            border-color: var(--primary-accent);
        }

        .mainDataInput,
        .contestDataInput {
            height: 100px;
        }

        .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
            width: 100%;
            margin-top: 25px;
        }

        .input-wrapper {
            display: flex;
            flex-direction: column;
        }

        .paste-btn-container {
            display: flex;
            justify-content: flex-end;
            padding-top: 8px;
        }

        .paste-btn {
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 600;
            background-color: var(--primary-accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            opacity: 0.9;
            transition: all 0.2s;
        }

        .paste-btn:hover {
            opacity: 1;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(16, 138, 177, 0.4);
        }

        /* 3D EMBOSSED BUTTONS */
        .action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 28px;
            font-size: 18px;
            font-weight: 800;
            font-family: 'Tahoma', 'Arial', sans-serif;
            /* Explicit Font Fix */
            color: var(--text-on-dark);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            /* Soft Clay Button Shadow */
            box-shadow:
                6px 6px 12px rgba(163, 177, 198, 0.4),
                -6px -6px 12px rgba(255, 255, 255, 0.4);
            transform: translateY(0);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            flex-grow: 1;
            max-width: 320px;
        }

        /* Shine effect on buttons */
        .action-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.2), transparent);
            pointer-events: none;
        }

        .action-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.2), 0 0 0 rgba(0, 0, 0, 0.2);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), -2px -2px 10px rgba(255, 255, 255, 0.5);
        }

        .action-btn svg {
            width: 20px;
            height: 20px;
        }

        .analyzeBtn {
            background: var(--primary-accent);
        }

        .captureBtn {
            background: linear-gradient(45deg, var(--success-color), #05B386);
        }

        .copySummaryBtn {
            background: linear-gradient(45deg, var(--primary-accent), #0d6c8b);
        }

        .dashboard-body {
            display: none;
            margin-top: 15px;
        }

        .report-title {
            text-align: center;
            font-size: 1.8em;
            font-weight: 700;
            margin: 10px 0 0 0;
            color: var(--text-primary);
        }

        #capture-area-rt>*+* {
            margin-top: 25px;
        }

        #capture-content-rt>*+* {
            margin-top: 25px;
        }

        .progress-bar-container {
            padding: 15px 25px;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .progress-track {
            width: 100%;
            height: 14px;
            background-color: rgba(230, 230, 230, 0.6);
            border-radius: 7px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1), inset 0 -1px 2px rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.4);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            border-radius: 7px;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            /* Glossy Liquid Effect - REDUCED OPACITY for better Color Visibility */
            background-color: var(--primary-accent);
            /* Default Color */
            background-image: linear-gradient(to bottom,
                    /* Highlight top */
                    rgba(255, 255, 255, 0.3) 0%,
                    rgba(255, 255, 255, 0.05) 40%,
                    rgba(0, 0, 0, 0.05) 100%);
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
        }

        .progress-text-wrapper {
            text-align: center;
            margin-top: 4px;
            font-size: 0.9em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .kpi-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }

        .sub-kpi-card {
            background: var(--glass-bg);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
            padding: 24px 10px;
            min-height: 160px;
            border-radius: 20px;
            /* Updated to match card radius */
            border: 1px solid var(--border-main);
            box-shadow: var(--clay-shadow);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(12px);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.2s ease-in-out;
        }

        .sub-kpi-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 45px 0 rgba(31, 38, 135, 0.15);
        }

        .sub-kpi-card:not(.kpi-installment-card):hover {
            background-color: rgba(255, 255, 255, 0.8);
        }

        .sub-kpi-card h4 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1.2em;
            margin: 0;
            color: var(--text-primary);
            font-weight: 700;
        }

        .sub-kpi-card h4 svg {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .sub-kpi-card:hover h4 svg {
            transform: scale(1.1);
        }

        .sub-kpi-card .value {
            font-size: 4em;
            font-weight: 700;
            margin: 0;
            color: var(--primary-accent);
            line-height: 1;
        }

        .sub-kpi-card .sub-text {
            font-size: 1em;
            color: var(--text-primary);
            font-weight: 600;
            margin: 0;
        }

        .kpi-installment-card {
            justify-content: center;
            gap: 10px;
        }

        .kpi-installment-card .text-content {
            text-align: center;
        }

        .kpi-installment-card .chart-content {
            width: 100px;
            height: 100px;
            position: relative;
            margin: 0 auto;
        }

        .kpi-installment-card .chart-content .chart-inner-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .dashboard-layout-grid {
            display: grid;
            gap: 25px;
            align-items: flex-start;
            grid-template-columns: 1fr 1fr;
        }

        .charts-column {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .chart-wrapper,
        .report-section {
            padding: 25px;
            min-width: 0;
        }

        .report-section h2,
        .chart-wrapper h2 {
            font-size: 1.8em;
            color: var(--primary-accent);
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .chart-wrapper h2 svg,
        .report-section h2 svg {
            width: 24px !important;
            height: 24px !important;
            flex-shrink: 0;
        }

        .chart-container {
            position: relative;
            width: 100%;
        }

        .summary-textarea {
            height: 500px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-main);
        }

        .toast-notification {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--success-color);
            color: white;
            padding: 16px 30px;
            border-radius: 8px;
            z-index: 1001;
            font-size: 1.1em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: bottom 0.5s ease-in-out;
        }

        .toast-notification.show {
            bottom: 30px;
        }

        .toast-notification.error {
            background-color: var(--danger-color);
        }

        .details-toggle {
            text-align: center;
            margin-top: 25px;
        }

        .details-toggle button {
            font-size: 0.9em;
            font-weight: 600;
            background: #6c757d;
            color: var(--text-on-dark);
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .details-toggle button:hover {
            background-color: #5a6268;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .rt-styled-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .rt-styled-table tbody tr {
            border-bottom: 1px solid var(--border-main);
            transition: background-color 0.2s;
        }

        .rt-styled-table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }

        .rt-styled-table th,
        .rt-styled-table td {
            text-align: center !important;
            vertical-align: middle;
            padding: 12px 10px;
            border-right: 1px solid var(--border-main);
            color: var(--text-primary);
        }

        .rt-styled-table th:last-child,
        .rt-styled-table td:last-child {
            border-right: none;
        }

        .rt-styled-table td:first-child,
        .rt-styled-table th:first-child {
            text-align: left !important;
        }

        .rt-styled-table thead th {
            background-color: var(--primary-accent);
            color: var(--text-on-dark);
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.9em;
            border-bottom: 1px solid var(--border-main);
        }

        .no-revenue-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px dashed var(--border-main);
            border-radius: 8px;
        }

        .no-revenue-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
            text-align: center;
            color: var(--text-muted);
            font-size: 1.1em;
            font-weight: 600;
        }

        /* Y√äU C·∫¶U 2: S·ª≠a l·ªói ch·ªØ to tr√™n ƒëi·ªán tho·∫°i */
        .no-revenue-grid {
            display: grid;
            /* Gi·∫£m min-width xu·ªëng ƒë·ªÉ kh√¥ng b·ªã √©p c·ªôt qu√° m·ª©c tr√™n mobile */
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px 15px;
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }

        .no-revenue-grid li {
            color: var(--text-primary);
            font-size: 14px;
            /* C·ªë ƒë·ªãnh c·ª° ch·ªØ ƒë·ªÉ tr√°nh b·ªã to b·∫•t th∆∞·ªùng */
            line-height: 1.4;
            display: flex;
            /* Flex ƒë·ªÉ cƒÉn ch·ªânh text v√† s·ªë ti·ªÅn */
            flex-direction: column;
            /* Tr√™n mobile n√™n ƒë·ªÉ s·ªë ti·ªÅn xu·ªëng d√≤ng n·∫øu d√†i */
        }

        .no-revenue-grid li .missing-amount {
            color: var(--danger-color);
            font-weight: 600;
            font-size: 0.9em;
        }

        /* NEW STYLES FOR CONTEST FILTER */
        #contestCategoryFilterControls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-top: 10px;
            padding: 15px 25px;
            border-radius: 15px;
            background-color: #eef4f7;
            width: 100%;
            justify-content: center;
            box-sizing: border-box;
            border: 1px solid var(--border-main);
        }

        #contestCategoryFilterControls label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
        }

        /* Modal styles for Category Selection */
        .modal {
            display: none;
            position: fixed;
            z-index: 1002;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 15px;
            box-shadow: var(--shadow-main);
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            transition: color 0.2s;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--danger-color);
            text-decoration: none;
            cursor: pointer;
        }

        .category-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-main);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .category-list label {
            display: block;
            padding: 5px 0;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px dotted #eee;
        }

        .category-list label:hover {
            background-color: #f8f9fa;
        }

        .category-list input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .action-btn-small {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0.9;
        }

        .action-btn-small:hover {
            opacity: 1;
            transform: translateY(-1px);
        }

        /* Media Queries */
        @media (max-width: 1200px) {
            .kpi-panel {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .input-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 992px) {
            .dashboard-layout-grid {
                grid-template-columns: 1fr 1fr !important;
            }

            /* Tr√™n PC th√¨ ƒë·ªÉ text v√† ti·ªÅn c√πng 1 d√≤ng cho ƒë·∫πp */
            .no-revenue-grid li {
                flex-direction: row;
                gap: 5px;
                align-items: center;
            }
        }

        @media (max-width: 992px) {
            .dashboard-layout-grid {
                grid-template-columns: 1fr !important;
            }

            #contestCategoryFilterControls {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 10px;
            }

            header h1 {
                font-size: 1.8em;
            }

            .card {
                padding: 15px;
            }

            .report-section h2,
            .chart-wrapper h2 {
                font-size: 1.5em;
            }

            .kpi-panel {
                grid-template-columns: repeat(2, 1fr);
            }

            .kpi-installment-card {
                flex-direction: column;
            }

            /* C·ª• th·ªÉ h√≥a fix font cho mobile */
            .no-revenue-grid {
                grid-template-columns: 1fr 1fr;
                /* 2 c·ªôt tr√™n mobile */
                gap: 10px;
            }

            .no-revenue-grid li {
                font-size: 13px !important;
                /* Force size nh·ªè h∆°n */
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>BI SI√äU TH·ªä (REAL-TIME)</h1>
        </header>

        <div id="realtimeInputGrid" class="input-grid"
            style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
            <div class="input-section">
                <h4><a href="https://bi.thegioididong.com/sieu-thi-con?id=16753&tab=bcdtnh&rt=1&dm=1" target="_blank"
                        rel="noopener noreferrer">D·ªØ li·ªáu Realtime Ng√†nh h√†ng</a></h4>
                <div class="input-wrapper">
                    <textarea id="realtimeDataInput" class="mainDataInput"
                        placeholder="D√°n d·ªØ li·ªáu ng√†nh h√†ng..."></textarea>
                    <div class="paste-btn-container">
                        <button class="paste-btn" data-target="realtimeDataInput">D√°n Th√¥ng Minh</button>
                    </div>
                </div>
            </div>
            <div class="input-section">
                <h4><a href="https://bi.thegioididong.com/thi-dua-st?id=16753&tab=1&rt=1&dm=2&mt=1" target="_blank"
                        rel="noopener noreferrer">D·ªØ li·ªáu Realtime Thi ƒëua</a></h4>
                <div class="input-wrapper">
                    <textarea id="realtimeContestDataInput" class="contestDataInput"
                        placeholder="D√°n d·ªØ li·ªáu thi ƒëua..."></textarea>
                    <div class="paste-btn-container">
                        <button class="paste-btn" data-target="realtimeContestDataInput">D√°n Th√¥ng Minh</button>
                    </div>
                </div>
            </div>
            <div class="input-section">
                <h4>Doanh thu Nh√¢n vi√™n (D√°n)</h4>
                <div class="input-wrapper">
                    <textarea id="employeeSalesDataInput" class="mainDataInput"
                        placeholder="D√°n d·ªØ li·ªáu doanh thu nh√¢n vi√™n v√†o ƒë√¢y..."></textarea>
                    <div class="paste-btn-container">
                        <button class="paste-btn" data-target="employeeSalesDataInput">D√°n Th√¥ng Minh</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="button-container">
            <button id="analyzeBtn-rt" class="action-btn analyzeBtn">T·∫†O DASHBOARD</button>
            <button id="showInputsBtnRt" class="action-btn" style="display: none; background: #6c757d;">Ch·ªânh s·ª≠a D·ªØ
                li·ªáu</button>
            <button id="captureBtnRt" class="action-btn captureBtn">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z" />
                </svg>
                Ch·ª•p ·∫£nh B√°o c√°o
            </button>
        </div>
        <div id="dashboard-body-rt" class="dashboard-body">
            <div id="capture-area-rt">
                <div id="capture-content-rt">
                    <div id="reportTitleRt" class="report-title"></div>
                    <div class="progress-bar-container card">
                        <div class="progress-labels"><span>Ti·∫øn ƒë·ªô Th·ªùi gian l√†m vi·ªác (8h-22h)</span><span
                                id="progress-summary-time">0%</span></div>
                        <div class="progress-track">
                            <div class="progress-fill" id="progress-fill-time"></div>
                        </div>
                        <div class="progress-text-wrapper"><span id="progress-text-time"></span></div>
                    </div>
                    <div class="progress-bar-container card">
                        <div class="progress-labels"><span>Ti·∫øn ƒë·ªô Target Ng√†y</span><span
                                id="progress-summary-target-rt"></span></div>
                        <div class="progress-track">
                            <div class="progress-fill" id="progress-fill-target-rt"></div>
                        </div>
                        <div class="progress-text-wrapper"><span id="progress-text-target-rt"></span></div>
                    </div>
                    <div id="kpi-panel-rt" class="kpi-panel"></div>

                    <!-- Contest Filter Controls -->
                    <div id="contestCategoryFilterControls">
                        <label><input type="checkbox" id="selectAllContestCategoriesRt" checked> Hi·ªÉn th·ªã T·∫§T C·∫¢ Ng√†nh
                            h√†ng</label>
                        <button id="openCategorySelectModalRt" class="action-btn-small"
                            style="background-color: var(--secondary-accent);">
                            Ch·ªçn Ng√†nh h√†ng c·ª• th·ªÉ
                        </button>
                        <span id="selectedCategoryCountRt" style="font-weight: 600; color: var(--text-primary);"></span>
                    </div>

                    <div id="employee-sales-chart-wrapper" class="card chart-wrapper"
                        style="display: none; padding: 25px;"></div>
                    <div class="dashboard-layout-grid"
                        style="grid-template-columns: 1fr 1fr; align-items: start; gap: 25px;">
                        <div id="contest-table-rt-wrapper" class="report-section card"></div>
                        <div id="category-table-rt-wrapper" class="report-section card"></div>
                    </div>
                </div>
            </div>
            <div id="summary-report-wrapper-rt" class="report-section card" style="display:none;"></div>

            <div id="summary-report-wrapper-rt-employee" class="report-section card"
                style="display:none; margin-top: 25px;"></div>
        </div>
    </div>

    <!-- Modal for Category Selection -->
    <div id="categorySelectModalRt" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Ch·ªçn Ng√†nh h√†ng Thi ƒëua</h2>
            <div class="category-list" id="categoryChecklistRt">
                <!-- Checkboxes s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
            </div>

            <!-- Import/Export Section -->
            <div class="import-export-section" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                <h4 style="margin: 0 0 5px 0; cursor: pointer; font-size: 1em; color: var(--text-primary); display: flex; align-items: center; justify-content: space-between;"
                    id="toggleImportExport">
                    <span>üìÇ Nh·∫≠p/Xu·∫•t Danh s√°ch (Click ƒë·ªÉ m·ªü)</span>
                    <span>‚ñº</span>
                </h4>
                <div id="importExportContainer" style="display: none;">
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Sao ch√©p m√£ d∆∞·ªõi ƒë√¢y ƒë·ªÉ chia s·∫ª ho·∫∑c
                        d√°n m√£ v√†o ƒë·ªÉ nh·∫≠p danh s√°ch:</p>
                    <textarea id="categoryConfigInput"
                        style="width: 100%; height: 60px; font-size: 12px; font-family: monospace; padding: 8px; box-sizing: border-box; border-radius: 5px; border: 1px solid #ccc;"
                        placeholder='["Ng√†nh A", "Ng√†nh B"]'></textarea>
                    <div style="display: flex; gap: 10px; margin-top: 8px;">
                        <button id="btnExportConfig" class="action-btn-small" style="background-color: #6c757d;">Sao
                            ch√©p (Xu·∫•t)</button>
                        <button id="btnImportConfig" class="action-btn-small"
                            style="background-color: var(--primary-accent);">√Åp d·ª•ng (Nh·∫≠p)</button>
                    </div>
                </div>
            </div>
            <!-- End Import/Export Section -->

            <div class="modal-footer" style="margin-top: 15px;">
                <button id="applyCategoryFilterBtnRt" class="action-btn-small"
                    style="background-color: var(--primary-accent);">√Åp d·ª•ng B·ªô l·ªçc</button>
            </div>
        </div>
    </div>

    <script>
        /****************************************************************************
         * SMART PASTE FUNCTIONS
         ****************************************************************************/
        function extractData(fullText, regex) {
            const match = fullText.match(regex);
            return (match && match[1]) ? match[1].trim() : '';
        }

        async function handleSmartPaste(targetId) {
            const targetTextarea = document.getElementById(targetId);
            if (!targetTextarea) return;

            try {
                const text = await navigator.clipboard.readText();
                if (!text) {
                    showToast('Clipboard r·ªóng!', true);
                    return;
                }

                let extractedData = '';
                switch (targetId) {
                    case 'realtimeDataInput':
                        extractedData = extractData(text, /(Nh√≥m ng√†nh h√†ng\tSL Realtime[\s\S]+?)H·ªó tr·ª£ BI/);
                        localStorage.setItem('realtimeMainData', extractedData || text);
                        break;
                    case 'realtimeContestDataInput':
                        extractedData = extractData(text, /(Ng√†nh h√†ng\tDT Realtime \(Qƒê\)[\s\S]+?)H·ªó tr·ª£ BI/);
                        localStorage.setItem('realtimeContestData', extractedData || text);
                        break;
                    case 'employeeSalesDataInput':
                        extractedData = extractData(text, /(Nh√¢n vi√™n\s+SL\s+DT[\s\S]+)/);
                        localStorage.setItem('employeeSalesData', extractedData || text);
                        break;
                    default:
                        extractedData = text;
                }

                targetTextarea.value = extractedData || text;
                showToast('ƒê√£ d√°n v√† l·ªçc d·ªØ li·ªáu th√¥ng minh!');

            } catch (err) {
                console.error('L·ªói khi d√°n: ', err);
                showToast('Kh√¥ng th·ªÉ truy c·∫≠p clipboard. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p c·ªßa tr√¨nh duy·ªát.', true);
            }
        }

        function setupSmartPasteButtons() {
            document.querySelectorAll('.paste-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const targetId = e.target.getAttribute('data-target');
                    handleSmartPaste(targetId);
                });
            });
        }

        /****************************************************************************
         * SHARED UTILITY & SETUP FUNCTIONS
         ****************************************************************************/
        var VIBRANT_PALETTE = ['#0ABDE3', '#00D2D3', '#FECA57', '#FF9F43', '#FF6B6B', '#5f27cd'];
        var formatNumber = (num, decimals = 0) => {
            const number = parseFloat(num);
            if (isNaN(number)) {
                return '';
            }
            return number.toLocaleString('vi-VN', { maximumFractionDigits: decimals });
        };
        var getColor = (value, threshold1 = 50, threshold2 = 100) => value < threshold1 ? '#FF6B6B' : value < threshold2 ? '#FECA57' : '#00D2D3';

        function showToast(message, isError = false) {
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            if (isError) toast.classList.add('error');
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.parentNode && toast.parentNode.removeChild(toast), 500);
            }, 3000);
        }

        // Global filter state for RT Contest
        const CONTEST_CATEGORY_FILTER_KEY_RT = 'contestCategoryFilter_RT';
        let allContestCategoriesRt = [];
        let currentSelectedCategoriesRt = [];

        function loadContestCategoryFilterRt(allNames) {
            try {
                const savedFilter = localStorage.getItem(CONTEST_CATEGORY_FILTER_KEY_RT);
                const selectAllCheckbox = document.getElementById('selectAllContestCategoriesRt');

                if (savedFilter && selectAllCheckbox) {
                    const parsedFilter = JSON.parse(savedFilter);
                    currentSelectedCategoriesRt = parsedFilter.filter(name => allNames.includes(name));

                    if (currentSelectedCategoriesRt.length === 0 && allNames.length > 0) {
                        currentSelectedCategoriesRt = [...allNames];
                        selectAllCheckbox.checked = true;
                        saveContestCategoryFilterRt(currentSelectedCategoriesRt);
                        return currentSelectedCategoriesRt;
                    }

                    selectAllCheckbox.checked = currentSelectedCategoriesRt.length === allNames.length;
                    return currentSelectedCategoriesRt;
                }
            } catch (e) {
                console.error("L·ªói khi t·∫£i b·ªô l·ªçc ng√†nh h√†ng RT:", e);
            }
            currentSelectedCategoriesRt = [...allNames];
            if (document.getElementById('selectAllContestCategoriesRt')) {
                document.getElementById('selectAllContestCategoriesRt').checked = true;
            }
            return currentSelectedCategoriesRt;
        }

        function saveContestCategoryFilterRt(selectedNames) {
            try {
                localStorage.setItem(CONTEST_CATEGORY_FILTER_KEY_RT, JSON.stringify(selectedNames));
            } catch (e) {
                console.error("L·ªói khi l∆∞u b·ªô l·ªçc ng√†nh h√†ng RT:", e);
            }
            currentSelectedCategoriesRt = selectedNames;
        }

        function getContestCategoriesToDisplayRt() {
            const isSelectAllChecked = document.getElementById('selectAllContestCategoriesRt')?.checked ?? true;

            if (isSelectAllChecked || currentSelectedCategoriesRt.length === 0) {
                return allContestCategoriesRt;
            }
            return currentSelectedCategoriesRt;
        }

        function renderCategoryChecklistRt(categories, selectedNames) {
            const checklist = document.getElementById('categoryChecklistRt');
            if (!checklist) return;

            checklist.innerHTML = `
            <label>
                <input type="checkbox" id="checkAllModalCategoriesRt" ${categories.length === selectedNames.length ? 'checked' : ''}>
                **Ch·ªçn t·∫•t c·∫£**
            </label>
            <hr style="margin: 5px 0;">
        `;

            categories.forEach(name => {
                const isChecked = selectedNames.includes(name);
                checklist.innerHTML += `
                <label>
                    <input type="checkbox" data-category-name="${name}" ${isChecked ? 'checked' : ''}>
                    ${name}
                </label>
            `;
            });

            const checkAll = document.getElementById('checkAllModalCategoriesRt');
            if (checkAll) {
                checkAll.addEventListener('change', (e) => {
                    checklist.querySelectorAll('input[type="checkbox"]').forEach(input => {
                        if (input.id !== 'checkAllModalCategoriesRt') {
                            input.checked = e.target.checked;
                        }
                    });
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            Chart.register(ChartDataLabels);
            Chart.defaults.color = 'var(--text-muted)';
            Chart.defaults.font.family = 'system-ui, -apple-system, sans-serif';
            Chart.defaults.font.weight = '600';

            setupRealtimeTab();
            setupSmartPasteButtons();

            try {
                document.getElementById('realtimeDataInput').value = localStorage.getItem('realtimeMainData') || '';
                document.getElementById('realtimeContestDataInput').value = localStorage.getItem('realtimeContestData') || '';
                document.getElementById('employeeSalesDataInput').value = localStorage.getItem('employeeSalesData') || '';
            } catch (e) {
                console.error("Could not access localStorage. Data will not be saved.", e);
                showToast("Kh√¥ng th·ªÉ truy c·∫≠p b·ªô nh·ªõ c·ª•c b·ªô. D·ªØ li·ªáu s·∫Ω kh√¥ng ƒë∆∞·ª£c l∆∞u.", true);
            }
        });

        /****************************************************************************
         * TAB 2: REAL-TIME LOGIC                                     *
         ****************************************************************************/
        function setupRealtimeTab() {
            let timeInterval;
            let employeeChart = null;
            let installmentChart = null;
            let lastEmployeeData = [];

            document.getElementById('analyzeBtn-rt').addEventListener('click', () => {
                const mainDataRaw = document.getElementById('realtimeDataInput').value;
                const contestDataRaw = document.getElementById('realtimeContestDataInput').value;
                const employeeDataRaw = document.getElementById('employeeSalesDataInput').value;

                try {
                    localStorage.setItem('realtimeMainData', mainDataRaw);
                    localStorage.setItem('realtimeContestData', contestDataRaw);
                    localStorage.setItem('employeeSalesData', employeeDataRaw);
                } catch (e) {
                    console.error("Could not access localStorage. Data will not be saved.", e);
                }

                if (!mainDataRaw.trim()) { showToast('Vui l√≤ng d√°n d·ªØ li·ªáu Realtime Ng√†nh h√†ng.', true); return; }
                try {
                    const mainParsedData = parseRealtimeData(mainDataRaw);
                    const contestDataRawTrimmed = contestDataRaw.trim();
                    const contestParsedData = contestDataRawTrimmed ? parseRealtimeData(contestDataRawTrimmed) : [];
                    const employeeDataRawTrimmed = employeeDataRaw.trim();
                    const employeeParsedData = employeeDataRawTrimmed ? parseEmployeeSalesData(employeeDataRawTrimmed) : [];

                    lastEmployeeData = employeeParsedData;

                    document.getElementById('realtimeInputGrid').style.display = 'none';
                    document.getElementById('showInputsBtnRt').style.display = 'inline-flex';

                    displayRealtimeDashboard(mainParsedData, contestParsedData, employeeParsedData);
                } catch (error) {
                    showToast("L·ªói x·ª≠ l√Ω d·ªØ li·ªáu Realtime: " + error.message, true);
                    console.error(error);
                }
            });

            document.getElementById('showInputsBtnRt').addEventListener('click', function () {
                const inputGrid = document.getElementById('realtimeInputGrid');
                const isHidden = inputGrid.style.display === 'none';
                inputGrid.style.display = isHidden ? 'grid' : 'none';
                this.textContent = isHidden ? '·∫®n M·ª•c Nh·∫≠p Li·ªáu' : 'Ch·ªânh s·ª≠a D·ªØ li·ªáu';
            });

            document.getElementById('captureBtnRt').addEventListener('click', () => {
                const dashboardBody = document.getElementById('dashboard-body-rt');
                if (dashboardBody.style.display === 'none') {
                    showToast('Ch∆∞a c√≥ d·ªØ li·ªáu Realtime ƒë·ªÉ ch·ª•p ·∫£nh.', true);
                    return;
                }

                const captureElement = document.getElementById('capture-content-rt');

                const mainContainer = document.querySelector('body');
                mainContainer.classList.add('capture-mode');

                setTimeout(() => {
                    html2canvas(captureElement, {
                        useCORS: true,
                        backgroundColor: '#F4F7F9',
                        scale: 2.5
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `b√°o c√°o realtime ${new Date().toLocaleTimeString('vi-VN')}.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    }).catch(err => {
                        showToast('L·ªói khi ch·ª•p ·∫£nh. H√£y th·ª≠ l·∫°i.', true);
                        console.error(err);
                    }).finally(() => {
                        mainContainer.classList.remove('capture-mode');
                    });
                }, 100);
            });

            // --- FILTER MODAL HANDLERS ---
            const selectAllCheckbox = document.getElementById('selectAllContestCategoriesRt');
            const modalBtn = document.getElementById('openCategorySelectModalRt');
            const modal = document.getElementById('categorySelectModalRt');
            const closeModalButton = modal.querySelector('.close-btn');

            // Toggle Import/Export Section
            const toggleImportExport = document.getElementById('toggleImportExport');
            const importExportContainer = document.getElementById('importExportContainer');
            if (toggleImportExport && importExportContainer) {
                toggleImportExport.addEventListener('click', () => {
                    const isHidden = importExportContainer.style.display === 'none';
                    importExportContainer.style.display = isHidden ? 'block' : 'none';
                    toggleImportExport.querySelector('span:last-child').textContent = isHidden ? '‚ñ≤' : '‚ñº';
                });
            }

            // Export Configuration
            const btnExportConfig = document.getElementById('btnExportConfig');
            const categoryConfigInput = document.getElementById('categoryConfigInput');
            if (btnExportConfig && categoryConfigInput) {
                btnExportConfig.addEventListener('click', () => {
                    const listToExport = currentSelectedCategoriesRt.length > 0 ? currentSelectedCategoriesRt : allContestCategoriesRt;
                    categoryConfigInput.value = JSON.stringify(listToExport);
                    categoryConfigInput.select();
                    document.execCommand('copy');
                    showToast('ƒê√£ sao ch√©p danh s√°ch v√†o Clipboard!');
                });
            }

            // Import Configuration
            const btnImportConfig = document.getElementById('btnImportConfig');
            if (btnImportConfig && categoryConfigInput) {
                btnImportConfig.addEventListener('click', () => {
                    const rawInput = categoryConfigInput.value.trim();
                    if (!rawInput) {
                        showToast('Vui l√≤ng d√°n danh s√°ch v√†o √¥ tr·ªëng!', true);
                        return;
                    }

                    let importedCategories = [];
                    try {
                        importedCategories = JSON.parse(rawInput);
                        if (!Array.isArray(importedCategories)) throw new Error("Not an array");
                    } catch (e) {
                        importedCategories = rawInput.split(/[\n,]+/).map(s => s.trim().replace(/['"]/g, '')).filter(s => s);
                    }

                    const validCategories = importedCategories.filter(name => allContestCategoriesRt.includes(name));

                    if (validCategories.length === 0) {
                        showToast('Kh√¥ng t√¨m th·∫•y ng√†nh h√†ng n√†o h·ª£p l·ªá trong danh s√°ch nh·∫≠p v√†o!', true);
                        return;
                    }

                    currentSelectedCategoriesRt = validCategories;
                    saveContestCategoryFilterRt(validCategories);

                    renderCategoryChecklistRt(allContestCategoriesRt, validCategories);

                    if (selectAllCheckbox) {
                        selectAllCheckbox.checked = (validCategories.length === allContestCategoriesRt.length);
                    }

                    showToast(`ƒê√£ nh·∫≠p th√†nh c√¥ng ${validCategories.length} ng√†nh h√†ng!`);
                    updateFilterControlsState();
                });
            }

            const updateFilterControlsState = () => {
                const isAllSelected = selectAllCheckbox ? selectAllCheckbox.checked : true;

                const countLabel = document.getElementById('selectedCategoryCountRt');
                if (countLabel) {
                    const selectedCount = isAllSelected ? allContestCategoriesRt.length : currentSelectedCategoriesRt.length;
                    countLabel.textContent = allContestCategoriesRt.length > 0
                        ? `(ƒê√£ ch·ªçn: ${selectedCount} / ${allContestCategoriesRt.length} nh√≥m)`
                        : '';
                }
            }

            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', () => {
                    const isChecked = selectAllCheckbox.checked;
                    if (isChecked) {
                        currentSelectedCategoriesRt = [...allContestCategoriesRt];
                        saveContestCategoryFilterRt(currentSelectedCategoriesRt);
                    } else {
                        if (currentSelectedCategoriesRt.length === allContestCategoriesRt.length) {
                            currentSelectedCategoriesRt = [];
                            saveContestCategoryFilterRt([]);
                        }
                    }
                    updateFilterControlsState();

                    if (document.getElementById('dashboard-body-rt').style.display !== 'none') {
                        document.getElementById('analyzeBtn-rt').click();
                    }
                });
            }

            if (modalBtn) {
                modalBtn.addEventListener('click', () => {
                    if (allContestCategoriesRt.length === 0) {
                        showToast('Vui l√≤ng t·∫°o Dashboard tr∆∞·ªõc ƒë·ªÉ l·∫•y danh s√°ch Ng√†nh h√†ng Thi ƒëua.', true);
                        return;
                    }
                    const listToRender = currentSelectedCategoriesRt;

                    renderCategoryChecklistRt(allContestCategoriesRt, listToRender);
                    modal.style.display = 'block';
                });
            }

            if (closeModalButton) closeModalButton.onclick = () => { modal.style.display = 'none'; };
            window.onclick = (event) => { if (event.target === modal) { modal.style.display = 'none'; } };

            if (document.getElementById('applyCategoryFilterBtnRt')) {
                document.getElementById('applyCategoryFilterBtnRt').addEventListener('click', () => {
                    const checklist = document.getElementById('categoryChecklistRt');
                    const selected = [];
                    checklist.querySelectorAll('input[type="checkbox"]').forEach(input => {
                        if (input.id !== 'checkAllModalCategoriesRt' && input.checked) {
                            selected.push(input.dataset.categoryName);
                        }
                    });

                    saveContestCategoryFilterRt(selected);
                    modal.style.display = 'none';

                    const isAllSelected = selected.length === allContestCategoriesRt.length;
                    if (selectAllCheckbox) selectAllCheckbox.checked = isAllSelected;

                    updateFilterControlsState();

                    showToast('ƒê√£ l∆∞u b·ªô l·ªçc Ng√†nh h√†ng!');

                    if (document.getElementById('dashboard-body-rt').style.display !== 'none') {
                        document.getElementById('analyzeBtn-rt').click();
                    }
                });
            }

            function parseRealtimeData(text) {
                const lines = text.trim().split('\n').filter(l => l.trim() !== '');
                if (lines.length < 1) {
                    return [];
                }
                const headers = lines[0].split('\t').map(h => h.trim().toLowerCase());

                const nameIndex = headers.findIndex(h => h.includes("ng√†nh h√†ng"));
                const actualIndex = headers.findIndex(h => h.includes("dt realtime") || h.includes('th·ª±c hi·ªán') || h.includes('dtqƒë') || h.includes('sllk') || h.includes('dtlk'));
                const targetIndex = headers.findIndex(h => h.includes("target ng√†y") || h.includes('target'));
                const percentIndex = headers.findIndex(h => h.includes("% ht target ng√†y") || h.includes('% ht'));
                const installmentIndex = headers.findIndex(h => h.includes("dt tr·∫£ g√≥p"));
                const installmentPercentIndex = headers.findIndex(h => h.includes("t·ª∑ tr·ªçng tr·∫£ g√≥p"));
                const quantityIndex = headers.findIndex(h => h.includes("sl realtime") || h.includes("s·ªë l∆∞·ª£ng"));

                if (nameIndex === -1 || actualIndex === -1 || targetIndex === -1) {
                    throw new Error("D·ªØ li·ªáu Realtime thi·∫øu c√°c c·ªôt b·∫Øt bu·ªôc. Vui l√≤ng ki·ªÉm tra l·∫°i ti√™u ƒë·ªÅ c√°c c·ªôt, c·∫ßn c√≥: 'Ng√†nh h√†ng', 'Th·ª±c hi·ªán' (ho·∫∑c 'DT Realtime'), v√† 'Target' (ho·∫∑c 'Target Ng√†y').");
                }

                const dataRows = lines.slice(1);
                return dataRows.map(line => {
                    const values = line.split('\t');

                    const getFloatValue = (index) => {
                        if (index === -1 || index >= values.length || !values[index]) return 0;
                        const cleanedValueStr = values[index].replace(/,/g, '').replace(/%/, '');
                        return parseFloat(cleanedValueStr) || 0;
                    }

                    return {
                        "Nh√≥m ng√†nh h√†ng": values[nameIndex] || '',
                        "DT Realtime (Qƒê)": getFloatValue(actualIndex),
                        "Target Ng√†y (Qƒê)": getFloatValue(targetIndex),
                        "% HT Target Ng√†y (Qƒê)": getFloatValue(percentIndex),
                        "DT Tr·∫£ G√≥p": getFloatValue(installmentIndex),
                        "T·ª∑ tr·ªçng tr·∫£ g√≥p": getFloatValue(installmentPercentIndex),
                        "S·ªë l∆∞·ª£ng": getFloatValue(quantityIndex)
                    };
                });
            }

            function parseEmployeeSalesData(text) {
                const lines = text.trim().split('\n');
                const data = [];

                lines.forEach(line => {
                    line = line.trim();
                    if (!line ||
                        line.toLowerCase().startsWith('nh√¢n vi√™n') ||
                        line.toLowerCase().startsWith('t·ªïng') ||
                        line.toLowerCase().includes('online')) {
                        return;
                    }

                    const regex = /^(\d+)\s*-\s*(.+?)\s+\d+\s+(-?[\d,.]+)$/;
                    const match = line.match(regex);

                    if (match) {
                        const id = match[1].trim();
                        const name = match[2].trim();
                        const revenueStr = match[3] || '0';
                        const revenue = parseFloat(revenueStr.replace(/,/g, '')) || 0;
                        data.push({ id, name, revenue });
                    }
                });

                return data;
            }

            function displayRealtimeDashboard(mainData, contestData, employeeData) {
                const dashboardBody = document.getElementById('dashboard-body-rt');
                if (dashboardBody) dashboardBody.style.display = 'block';

                if (timeInterval) clearInterval(timeInterval);

                if (employeeChart) { employeeChart.destroy(); employeeChart = null; }
                if (installmentChart) { installmentChart.destroy(); installmentChart = null; }

                renderTimeProgressBar();
                timeInterval = setInterval(renderTimeProgressBar, 60000);

                const totalRow = mainData.find(row => row["Nh√≥m ng√†nh h√†ng"].toLowerCase() === "t·ªïng");
                if (!totalRow) throw new Error("Kh√¥ng t√¨m th·∫•y d√≤ng 'T·ªïng' trong d·ªØ li·ªáu Realtime.");

                const processedContestData = processRealtimeContestData(contestData);

                const contestCategories = processedContestData.all.map(item => item.name);
                allContestCategoriesRt = [...new Set(contestCategories)].sort();

                loadContestCategoryFilterRt(allContestCategoriesRt);

                const now = new Date();
                const timeString = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
                const currentHour = now.getHours();

                let timeIcon = '';
                if (currentHour < 12) {
                    timeIcon = '‚òÄÔ∏è ';
                } else if (currentHour < 18) {
                    timeIcon = 'üåá ';
                } else {
                    timeIcon = 'üåô ';
                }
                const titleEl = document.getElementById('reportTitleRt');
                if (titleEl) titleEl.textContent = `${timeIcon}B√°o c√°o doanh thu si√™u th·ªã ƒë·∫øn ${timeString}`;

                renderRealtimeKPIs(totalRow, processedContestData);
                renderRealtimeTargetProgress(totalRow);
                renderEmployeeSalesChart(employeeData);

                renderRealtimeContestTable(processedContestData);

                renderRealtimeCategoryTable(mainData);

                renderRealtimeSummary(totalRow, processedContestData);

                const employeeSummaryContainer = document.getElementById('summary-report-wrapper-rt-employee');
                if (employeeSummaryContainer) employeeSummaryContainer.style.display = 'none';

                updateFilterControlsState();
            }

            function getTimePassedFraction() {
                const now = new Date();
                const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 8, 0, 0);
                const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 22, 0, 0);
                if (now <= start) return 0.001;
                if (now >= end) return 1;
                const totalMinutes = (end - start) / 60000;
                const elapsedMinutes = (now - start) / 60000;
                return elapsedMinutes / totalMinutes;
            }

            function processRealtimeContestData(contestData) {
                if (!contestData || contestData.length === 0) return { all: [], onTrack: [], behind: [], veDich_actual: [], canCoGang_actual: [], canTapTrung_actual: [], baoDong_actual: [] };
                const timeFraction = getTimePassedFraction();

                const items = contestData
                    .filter(row => row["Nh√≥m ng√†nh h√†ng"].toLowerCase() !== 't·ªïng' && row["Nh√≥m ng√†nh h√†ng"].toLowerCase() !== 'ng√†nh h√†ng')
                    .map(row => {
                        const actual = row['DT Realtime (Qƒê)'];
                        const target = row['Target Ng√†y (Qƒê)'];
                        const projectedSales = timeFraction > 0 && timeFraction < 1 ? (actual / timeFraction) : actual;
                        const percentProjected = target > 0 ? (projectedSales / target * 100) : 0;
                        return {
                            name: row['Nh√≥m ng√†nh h√†ng'],
                            actual: actual,
                            target: target,
                            remaining: target - actual,
                            percentProjected: percentProjected,
                            percentActual: row['% HT Target Ng√†y (Qƒê)']
                        };
                    })
                    .sort((a, b) => b.percentProjected - a.percentProjected);

                return {
                    all: items,
                    onTrack: items.filter(p => p.percentProjected >= 100),
                    behind: items.filter(p => p.percentProjected < 100),
                    veDich_actual: items.filter(p => p.percentActual >= 100),
                    canCoGang_actual: items.filter(p => p.percentActual >= 80 && p.percentActual < 100),
                    canTapTrung_actual: items.filter(p => p.percentActual >= 50 && p.percentActual < 80),
                    baoDong_actual: items.filter(p => p.percentActual < 50)
                };
            }

            function renderTimeProgressBar() {
                const percent = getTimePassedFraction() * 100;
                const now = new Date();
                const fill = document.getElementById('progress-fill-time');
                if (fill) fill.style.width = `${percent}%`;

                const text = document.getElementById('progress-text-time');
                if (text) text.textContent = `ƒê√£ qua ${formatNumber(percent, 1)}% th·ªùi gian (${now.toLocaleTimeString('vi-VN')})`;

                const summary = document.getElementById('progress-summary-time');
                if (summary) summary.textContent = now.toLocaleTimeString('vi-VN');
            }

            function renderRealtimeTargetProgress(totalRow) {
                const htThuc = totalRow['% HT Target Ng√†y (Qƒê)'];
                const progressFill = document.getElementById('progress-fill-target-rt');
                if (progressFill) {
                    progressFill.style.width = `${htThuc > 100 ? 100 : htThuc}%`;
                    progressFill.style.backgroundColor = getColor(htThuc);
                }

                const text = document.getElementById('progress-text-target-rt');
                if (text) text.textContent = `Th·ª±c t·∫ø ${formatNumber(htThuc, 1)}%`;

                const summary = document.getElementById('progress-summary-target-rt');
                if (summary) summary.textContent = `${formatNumber(totalRow['DT Realtime (Qƒê)'])} / ${formatNumber(totalRow['Target Ng√†y (Qƒê)'])}`;
            }

            function renderRealtimeKPIs(totalRow, contestData) {
                const kpiPanel = document.getElementById('kpi-panel-rt');
                if (!kpiPanel) return;

                const ht = totalRow['% HT Target Ng√†y (Qƒê)'];
                const timeFraction = getTimePassedFraction();
                const projectedSales = timeFraction > 0 && timeFraction < 1 ? (totalRow['DT Realtime (Qƒê)'] / timeFraction) : totalRow['DT Realtime (Qƒê)'];
                const projectedHt = totalRow['Target Ng√†y (Qƒê)'] > 0 ? (projectedSales / totalRow['Target Ng√†y (Qƒê)'] * 100) : 0;
                const remainingRevenue = totalRow['Target Ng√†y (Qƒê)'] - totalRow['DT Realtime (Qƒê)'];
                const installmentPercent = totalRow['T·ª∑ tr·ªçng tr·∫£ g√≥p'];

                const categoriesToDisplay = getContestCategoriesToDisplayRt();
                const filteredAll = contestData.all.filter(item => categoriesToDisplay.includes(item.name));
                const onTrackCount = filteredAll.filter(p => p.percentProjected >= 100).length;
                const totalCount = filteredAll.length;

                const getInstallmentColor = (percent) => {
                    if (percent < 20) return '#F04770';
                    if (percent < 30) return '#F78C6A';
                    return '#06D7A0';
                };

                const kpis = [
                    { id: 'kpi-target', title: 'Target Ng√†y', value: formatNumber(totalRow['Target Ng√†y (Qƒê)']), subtext: 'M·ª•c ti√™u h√¥m nay', icon: '<path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,6A6,6 0 0,1 18,12C18,14.21 16.84,16.21 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.16,16.21 6,14.21 6,12A6,6 0 0,1 12,6M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z"/>', iconColor: 'var(--primary-accent)' },
                    { id: 'kpi-realtime', title: 'DT Realtime', value: formatNumber(totalRow['DT Realtime (Qƒê)']), subtext: `${formatNumber(ht, 1)}% HT`, color: getColor(ht), icon: '<path fill="currentColor" d="M9 14.5A2.5 2.5 0 0 1 6.5 12A2.5 2.5 0 0 1 9 9.5V14.5M9 16.5A4.5 4.5 0 0 0 13.5 12A4.5 4.5 0 0 0 9 7.5V16.5M22 12l-4-4v3H3v2h15v3l4-4Z"/>', iconColor: 'var(--success-color)' },
                    { id: 'kpi-remaining', title: 'DT C√≤n l·∫°i', value: remainingRevenue <= 0 ? 'üèÜ' : formatNumber(remainingRevenue), subtext: remainingRevenue <= 0 ? 'ƒê√£ ho√†n th√†nh!' : 'C·∫ßn ƒë·∫°t th√™m', color: remainingRevenue <= 0 ? '#06D7A0' : '#F04770', icon: '<path fill="currentColor" d="M12,6A6,6 0 0,1 18,12C18,14.21 16.84,16.21 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.16,16.21 6,14.21 6,12A6,6 0 0,1 12,6M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z"/>', iconColor: remainingRevenue <= 0 ? 'var(--warning-color)' : 'var(--danger-color)' },
                    { id: 'kpi-projected', title: 'D·ª± ki·∫øn ƒë·∫°t', value: formatNumber(projectedSales), subtext: `${formatNumber(projectedHt, 1)}%`, color: getColor(projectedHt), icon: '<path fill="currentColor" d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6h-6z"/>', iconColor: 'var(--secondary-accent)' },
                    { id: 'kpi-contest', title: 'Thi ƒëua ƒë·∫°t', value: totalCount > 0 ? `${onTrackCount}/${totalCount}` : 'N/A', subtext: totalCount > 0 ? `${formatNumber(totalCount > 0 ? (onTrackCount / totalCount * 100) : 0, 1)}% V·ªÅ ƒê√≠ch` : 'Ch∆∞a c√≥ d·ªØ li·ªáu', icon: '<path fill="currentColor" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>', iconColor: '#6654A2' },
                    { id: 'kpi-installment', title: 'T·ª∑ tr·ªçng Tr·∫£ g√≥p', value: `${formatNumber(installmentPercent, 2)}%`, subtext: "DT: " + formatNumber(totalRow['DT Tr·∫£ G√≥p']), icon: '<path fill="currentColor" d="M21,11H12.42A3,3 0 0,1 12,11.58V13.42A3,3 0 0,1 12.42,14H21V16H12.42A3,3 0 0,1 10,18.42V20H8V18.42A3,3 0 0,1 5.58,16H3V14H5.58A3,3 0 0,1 8,11.58V10H10V11.58A3,3 0 0,1 12.42,14H15V12H12.42A3,3 0 0,1 10,9.58V8H8V9.58A3,3 0 0,1 5.58,12H3V10H5.58A3,3 0 0,1 8,7.58V6H10V7.58A3,3 0 0,1 12.42,10H21V11Z"/>', iconColor: '#D65E9A' },
                ];

                kpiPanel.innerHTML = kpis.map(kpi => {
                    if (kpi.id === 'kpi-installment') {
                        return `<div class="sub-kpi-card kpi-installment-card">
                                <div class="text-content">
                                    <h4><svg class="title-icon" viewBox="0 0 24 24" style="color:${kpi.iconColor};">${kpi.icon}</svg>${kpi.title}</h4>
                                    <p class="sub-text">${kpi.subtext}</p>
                                </div>
                                <div class="chart-content">
                                    <canvas id="installment-pie-chart-rt"></canvas>
                                    <div id="installment-pie-text" class="chart-inner-text"></div>
                                </div>
                            </div>`;
                    }

                    if (kpi.id === 'kpi-remaining' && remainingRevenue <= 0) {
                        kpi.icon = '<path fill="currentColor" d="M20.5,11H19V7A1,1 0 0,0 18,6H16A1,1 0 0,0 15,7V11H9V7A1,1 0 0,0 8,6H6A1,1 0 0,0 5,7V11H3.5A1.5,1.5 0 0,0 2,12.5A1.5,1.5 0 0,0 3.5,14H5V18A3,3 0 0,0 8,21H16A3,3 0 0,0 19,18V14H20.5A1.5,1.5 0 0,0 22,12.5A1.5,1.5 0 0,0 20.5,11M17,11H16V8H17V11M7,11H8V8H7V11Z"/>';
                    }

                    return `<div class="sub-kpi-card">
                            <h4><svg class="title-icon" viewBox="0 0 24 24" style="color: ${kpi.iconColor};">${kpi.icon}</svg>${kpi.title}</h4>
                            <p class="value" style="color: ${kpi.color || 'var(--primary-accent)'}">${kpi.value}</p>
                            <p class="sub-text">${kpi.subtext}</p>
                        </div>`;
                }).join('');

                setTimeout(() => {
                    const canvas = document.getElementById('installment-pie-chart-rt');
                    const installmentText = document.getElementById('installment-pie-text');

                    if (canvas && installmentText) {
                        installmentText.textContent = `${formatNumber(installmentPercent, 1)}%`;
                        const installmentCtx = canvas.getContext('2d');

                        installmentChart = new Chart(installmentCtx, {
                            type: 'doughnut',
                            data: {
                                datasets: [{
                                    data: [installmentPercent, 100 - installmentPercent],
                                    backgroundColor: [getInstallmentColor(installmentPercent), '#e9ecef'],
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                cutout: '75%',
                                plugins: {
                                    legend: { display: false },
                                    tooltip: { enabled: false },
                                    datalabels: { display: false }
                                }
                            }
                        });
                    }
                }, 0);
            }

            function renderEmployeeSalesChart(data) {
                const wrapper = document.getElementById('employee-sales-chart-wrapper');
                if (!data || data.length === 0) {
                    if (wrapper) wrapper.style.display = 'none';
                    return;
                }
                if (wrapper) wrapper.style.display = 'block';

                const sortedData = data.sort((a, b) => b.revenue - a.revenue);

                const numEmployees = sortedData.length;
                const minChartHeight = 400;
                const barHeight = 40;
                const dynamicHeight = Math.max(minChartHeight, numEmployees * barHeight + 100);

                wrapper.innerHTML = `<h2><svg class="title-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg>X·∫øp h·∫°ng Doanh thu Nh√¢n vi√™n</h2><div class="chart-container" style="min-height: ${dynamicHeight}px;"><canvas id="employeeSalesChart"></canvas></div>`;

                const canvas = document.getElementById('employeeSalesChart');
                const ctx = canvas.getContext('2d');

                const totalRevenue = sortedData.filter(d => d.revenue > 0).reduce((sum, item) => sum + item.revenue, 0);
                const chartData = sortedData;

                const labels = chartData.map((d, index) => {
                    const rank = index + 1;
                    const percentageVal = totalRevenue > 0 && d.revenue > 0 ? (d.revenue / totalRevenue * 100).toFixed(1) : 0;

                    let revStr = "";
                    if (Math.abs(d.revenue) >= 1000000) {
                        revStr = formatNumber(d.revenue / 1000000, 1) + 'tr';
                    } else {
                        revStr = formatNumber(d.revenue);
                    }

                    const percentStr = d.revenue > 0 ? `, ${percentageVal}%` : '';

                    let icon = '';
                    if (rank === 1) icon = 'ü•á ';
                    else if (rank === 2) icon = 'ü•à ';
                    else if (rank === 3) icon = 'ü•â ';

                    return `${icon}${rank}. ${d.name} (${revStr}${percentStr})`;
                });

                const revenues = chartData.map(d => d.revenue);
                const positiveRevenues = revenues.filter(r => r > 0);
                const maxRevenue = positiveRevenues.length > 0 ? Math.max(...positiveRevenues) : 0;
                const minRevenue = positiveRevenues.length > 0 ? Math.min(...positiveRevenues) : 0;

                const highColor = { r: 6, g: 215, b: 160 };
                const midColor = { r: 255, g: 209, b: 103 };
                const lowColor = { r: 240, g: 71, b: 112 };

                function interpolateColor(color1, color2, factor) {
                    let result = { ...color1 };
                    for (let i in result) {
                        result[i] = Math.round(result[i] + factor * (color2[i] - color1[i]));
                    }
                    return `rgb(${result.r}, ${result.g}, ${result.b})`;
                }

                function getRevenueColor(value) {
                    if (value <= 0) return `rgb(${lowColor.r}, ${lowColor.g}, ${lowColor.b})`;
                    if (maxRevenue === minRevenue) return `rgb(${highColor.r}, ${highColor.g}, ${highColor.b})`;

                    const normalizedValue = Math.max(0, value - minRevenue);
                    const normalizedMax = maxRevenue - minRevenue;

                    const percentage = normalizedMax > 0 ? normalizedValue / normalizedMax : 1;

                    if (percentage > 0.5) {
                        return interpolateColor(midColor, highColor, (percentage - 0.5) * 2);
                    } else {
                        return interpolateColor(lowColor, midColor, percentage * 2);
                    }
                }

                employeeChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Doanh thu',
                            data: revenues,
                            backgroundColor: (context) => getRevenueColor(context.raw),
                            borderColor: 'rgba(7, 58, 75, 0.4)',
                            borderWidth: 1,
                            borderRadius: 8,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                grid: { color: 'rgba(0, 0, 0, 0.05)', borderDash: [2, 4] },
                                ticks: {
                                    callback: (value) => formatNumber(value / 1000000, 1) + 'tr'
                                }
                            },
                            y: {
                                grid: { display: false },
                                ticks: {
                                    font: { size: 12, weight: '600' },
                                    color: '#073A4B'
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(7, 58, 75, 0.9)',
                                callbacks: {
                                    title: (context) => {
                                        const item = chartData[context[0].dataIndex];
                                        return item.name;
                                    },
                                    label: (context) => `Doanh thu: ${formatNumber(context.raw)} VNƒê`
                                }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'end',
                                rotation: 0,
                                color: 'var(--text-primary)',
                                font: { weight: 'bold', size: 12 },
                                formatter: (value) => value !== 0 ? formatNumber(value / 1000000, 1) + 'tr' : '',
                                offset: 4,
                                clamp: false
                            }
                        }
                    }
                });
            }

            function renderRealtimeContestTable(processedContest) {
                const wrapper = document.getElementById('contest-table-rt-wrapper');

                const categoriesToDisplay = getContestCategoriesToDisplayRt();
                const filteredAll = processedContest.all.filter(item => categoriesToDisplay.includes(item.name));

                if (!filteredAll || filteredAll.length === 0) {
                    const totalContestCategories = allContestCategoriesRt.length;
                    let message = 'Kh√¥ng c√≥ d·ªØ li·ªáu thi ƒëua.';
                    if (totalContestCategories > 0 && categoriesToDisplay.length === 0) {
                        message = `Kh√¥ng c√≥ ng√†nh h√†ng n√†o ƒë∆∞·ª£c ch·ªçn trong ${totalContestCategories} nh√≥m thi ƒëua. Vui l√≤ng ch·ªçn ng√†nh h√†ng c·ª• th·ªÉ ho·∫∑c ch·ªçn "Hi·ªÉn th·ªã T·∫§T C·∫¢".`;
                    } else if (totalContestCategories > 0) {
                        message = `Kh√¥ng c√≥ d·ªØ li·ªáu thi ƒëua cho c√°c ng√†nh h√†ng ƒë√£ ch·ªçn (${categoriesToDisplay.length}/${totalContestCategories} nh√≥m).`;
                    }

                    wrapper.innerHTML = `<h2><svg class="title-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M5,4H19A2,2 0 0,1 21,6V18A2,2 0 0,1 19,20H5A2,2 0 0,1 3,18V6A2,2 0 0,1 5,4M5,8V12H11V8H5M13,8V12H19V8H13M5,14V18H11V14H5M13,14V18H19V14H13Z" /></svg>B·∫£ng chi ti·∫øt Thi ƒëua Real-time</h2><p>${message}</p>`;
                    return;
                }
                wrapper.style.display = 'block';

                const itemsWithRevenue = filteredAll.filter(item => item.actual > 0);
                const itemsWithoutRevenue = filteredAll.filter(item => item.actual <= 0);

                const completedItems = filteredAll.filter(p => p.percentProjected >= 100).length;
                const totalItems = filteredAll.length;

                const progressPercentContest = totalItems > 0 ? (completedItems / totalItems * 100) : 0;
                const contestProgressColor = getColor(progressPercentContest);
                const progressBarHtml = `
                <div class="progress-bar-container" style="padding: 0 0 20px 0;">
                    <div class="progress-labels">
                        <span>Ti·∫øn ƒë·ªô V·ªÅ ƒê√≠ch</span>
                        <span>${completedItems} / ${totalItems} Nh√≥m</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" style="width: ${progressPercentContest}%; background-color: ${contestProgressColor};"></div>
                    </div>
                    <div class="progress-text-wrapper"><span class="progress-text">${formatNumber(progressPercentContest, 1)}%</span></div>
                </div>`;

                let tableHtml = `<h2><svg class="title-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M5,4H19A2,2 0 0,1 21,6V18A2,2 0 0,1 19,20H5A2,2 0 0,1 3,18V6A2,2 0 0,1 5,4M5,8V12H11V8H5M13,8V12H19V8H13M5,14V18H11V14H5M13,14V18H19V14H13Z" /></svg>B·∫£ng chi ti·∫øt Thi ƒëua Real-time</h2>
                                 ${progressBarHtml}
                                 <table class="rt-styled-table">
                                     <thead>
                                         <tr><th>#</th><th>Ng√†nh h√†ng</th><th>DT Realtime</th><th>C√≤n l·∫°i</th><th>Target Ng√†y</th><th>% HT</th><th>% HT D·ª± ki·∫øn</th></tr>
                                     </thead>
                                     <tbody>`;

                itemsWithRevenue.forEach((item, index) => {
                    const remainingCell = item.remaining <= 0 ? `<td style="color: var(--success-color); font-weight: bold; font-size: 1.5em;">üèÜ</td>` : `<td style="color: var(--danger-color); font-weight: bold;">${formatNumber(item.remaining, 1)}</td>`;
                    const icon = item.percentProjected >= 100 ? ' <span title="D·ª± ki·∫øn ho√†n th√†nh!">üöÄ</span>' : '';
                    tableHtml += `<tr>
                    <td>${index + 1}${icon}</td>
                    <td style="text-align: left !important;">${item.name}</td>
                    <td>${formatNumber(item.actual)}</td>
                    ${remainingCell}
                    <td>${formatNumber(item.target)}</td>
                    <td style="color: ${getColor(item.percentActual)}; font-weight: bold;">${formatNumber(item.percentActual, 1)}%</td>
                    <td style="color: ${getColor(item.percentProjected)}; font-weight: bold;">${formatNumber(item.percentProjected, 1)}%</td>
                </tr>`;
                });
                tableHtml += '</tbody></table>';
                wrapper.innerHTML = tableHtml;

                if (itemsWithoutRevenue.length > 0) {
                    // Y√äU C·∫¶U 3: Hi·ªÉn th·ªã th√™m s·ªë ti·ªÅn thi·∫øu
                    const noRevenueHtml = `<div id="contest-no-revenue-section" class="no-revenue-section">
                                     <h4>Nh√≥m ch∆∞a ph√°t sinh doanh thu (${itemsWithoutRevenue.length} nh√≥m):</h4>
                                     <ul class="no-revenue-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                                         ${itemsWithoutRevenue.map((item, index) =>
                        `<li>
                                                <span>${index + 1}. ${item.name}</span>
                                                <span class="missing-amount">(-${formatNumber(item.target)})</span>
                                             </li>`
                    ).join('')}
                                     </ul>
                                   </div>`;
                    const buttonHtml = `<div class="details-toggle" style="margin-top: 15px;">
                                    <button id="toggle-contest-no-revenue-btn">
                                        ·∫®n ${itemsWithoutRevenue.length} nh√≥m ch∆∞a c√≥ DT
                                    </button>
                                </div>`;

                    wrapper.insertAdjacentHTML('beforeend', buttonHtml + noRevenueHtml);

                    const noRevenueSection = document.getElementById('contest-no-revenue-section');
                    const toggleBtn = document.getElementById('toggle-contest-no-revenue-btn');

                    if (noRevenueSection) noRevenueSection.style.display = 'block';

                    if (toggleBtn && noRevenueSection) {
                        toggleBtn.addEventListener('click', () => {
                            const isHidden = noRevenueSection.style.display !== 'block';
                            noRevenueSection.style.display = isHidden ? 'block' : 'none';
                            toggleBtn.textContent = isHidden ? `·∫®n ${itemsWithoutRevenue.length} nh√≥m ch∆∞a c√≥ DT` : `Hi·ªán ${itemsWithoutRevenue.length} nh√≥m ch∆∞a c√≥ DT`;
                        });
                    }
                }
            }

            function renderRealtimeCategoryTable(mainData) {
                const wrapper = document.getElementById('category-table-rt-wrapper');
                if (!mainData || mainData.length === 0) {
                    if (wrapper) wrapper.style.display = 'none';
                    return;
                }
                if (wrapper) wrapper.style.display = 'block';

                const totalRow = mainData.find(row => row["Nh√≥m ng√†nh h√†ng"].toLowerCase() === "t·ªïng");
                const categoryData = mainData.filter(row =>
                    row["Nh√≥m ng√†nh h√†ng"].toLowerCase() !== "t·ªïng" &&
                    row["Target Ng√†y (Qƒê)"] > 0
                );

                const categoriesWithRevenue = categoryData.filter(row => row["DT Realtime (Qƒê)"] > 0).sort((a, b) => b["DT Realtime (Qƒê)"] - a["DT Realtime (Qƒê)"]);
                const categoriesWithoutRevenue = categoryData.filter(row => row["DT Realtime (Qƒê)"] <= 0);

                let mainProgressBarHtml = '';
                if (totalRow) {
                    const htThuc = totalRow['% HT Target Ng√†y (Qƒê)'];
                    mainProgressBarHtml = `<div class="progress-bar-container" style="padding: 0 0 20px 0;">
                                    <div class="progress-labels"><span>Ti·∫øn ƒë·ªô Target Ng√†y (T·ªïng)</span><span>${formatNumber(totalRow['DT Realtime (Qƒê)'])} / ${formatNumber(totalRow['Target Ng√†y (Qƒê)'])}</span></div>
                                    <div class="progress-track"><div class="progress-fill" style="width: ${htThuc > 100 ? 100 : htThuc}%; background-color: ${getColor(htThuc)};"></div></div>
                                    <div class="progress-text-wrapper"><span class="progress-text">${formatNumber(htThuc, 1)}%</span></div>
                                </div>`;
                }

                let tableHtml = `<h2><svg class="title-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M3,4H21V6H3V4M3,7H21V9H3V7M3,10H21V12H3V10M3,13H21V15H3V13M3,16H21V18H3V16Z"/></svg>B·∫£ng chi ti·∫øt Ng√†nh h√†ng</h2>
                                 ${mainProgressBarHtml}
                                 <table class="rt-styled-table">
                                     <thead><tr><th>Ng√†nh h√†ng</th><th>SL</th><th>DT Realtime</th><th>Target Ng√†y</th><th>% HT</th><th>% Tr·∫£ G√≥p</th></tr></thead>
                                     <tbody>`;
                if (totalRow) {
                    tableHtml += `<tr style="font-weight:bold; background-color: #e9ecef;">
                                     <td style="text-align: left !important;">${totalRow["Nh√≥m ng√†nh h√†ng"]}</td><td>${formatNumber(totalRow["S·ªë l∆∞·ª£ng"])}</td><td>${formatNumber(totalRow["DT Realtime (Qƒê)"])}</td><td>${formatNumber(totalRow["Target Ng√†y (Qƒê)"])}</td><td style="color: ${getColor(totalRow["% HT Target Ng√†y (Qƒê)"])};">${formatNumber(totalRow["% HT Target Ng√†y (Qƒê)"], 1)}%</td><td>${formatNumber(totalRow["T·ª∑ tr·ªçng tr·∫£ g√≥p"], 2)}%</td>
                                 </tr>`;
                }
                categoriesWithRevenue.forEach(row => {
                    tableHtml += `<tr><td style="text-align: left !important;">${row["Nh√≥m ng√†nh h√†ng"]}</td><td>${formatNumber(row["S·ªë l∆∞·ª£ng"])}</td><td>${formatNumber(row["DT Realtime (Qƒê)"])}</td><td>${formatNumber(row["Target Ng√†y (Qƒê)"])}</td><td style="color: ${getColor(row["% HT Target Ng√†y (Qƒê)"])}; font-weight: bold;">${formatNumber(row["% HT Target Ng√†y (Qƒê)"], 1)}%</td><td>${formatNumber(row["T·ª∑ tr·ªçng tr·∫£ g√≥p"], 2)}%</td></tr>`;
                });
                tableHtml += '</tbody></table>';
                wrapper.innerHTML = tableHtml;

                if (categoriesWithoutRevenue.length > 0) {
                    // Y√äU C·∫¶U 3: Hi·ªÉn th·ªã th√™m s·ªë ti·ªÅn thi·∫øu
                    const noRevenueHtml = `<div id="category-no-revenue-section" class="no-revenue-section">
                                     <h4>Ng√†nh h√†ng ch∆∞a ph√°t sinh doanh thu (${categoriesWithoutRevenue.length}):</h4>
                                     <ul class="no-revenue-grid">
                                         ${categoriesWithoutRevenue.map((item, index) =>
                        `<li>
                                                <span>${index + 1}. ${item["Nh√≥m ng√†nh h√†ng"]}</span>
                                                <span class="missing-amount">(-${formatNumber(item["Target Ng√†y (Qƒê)"])})</span>
                                             </li>`
                    ).join('')}
                                     </ul>
                                   </div>`;

                    const buttonHtml = `<div class="details-toggle" style="margin-top: 15px;">
                                    <button id="toggle-category-no-revenue-btn">
                                        ·∫®n ${categoriesWithoutRevenue.length} ng√†nh h√†ng ch∆∞a c√≥ DT
                                    </button>
                                </div>`;

                    wrapper.insertAdjacentHTML('beforeend', buttonHtml + noRevenueHtml);

                    const noRevenueSection = document.getElementById('category-no-revenue-section');
                    const toggleBtn = document.getElementById('toggle-category-no-revenue-btn');

                    if (noRevenueSection) noRevenueSection.style.display = 'block';

                    if (toggleBtn && noRevenueSection) {
                        toggleBtn.addEventListener('click', () => {
                            const isHidden = noRevenueSection.style.display !== 'block';
                            noRevenueSection.style.display = isHidden ? 'block' : 'none';
                            toggleBtn.textContent = isHidden ? `·∫®n ${categoriesWithoutRevenue.length} ng√†nh h√†ng ch∆∞a c√≥ DT` : `Hi·ªán ${categoriesWithoutRevenue.length} ng√†nh h√†ng ch∆∞a c√≥ DT`;
                        });
                    }
                }
            }

            function renderRealtimeSummary(totalRow, contestData) {
                const container = document.getElementById('summary-report-wrapper-rt');
                if (container) container.style.display = 'block';
                if (!totalRow) { if (container) container.innerHTML = ''; return; }

                const categoriesToDisplay = getContestCategoriesToDisplayRt();
                const filteredAllContest = contestData.all.filter(item => categoriesToDisplay.includes(item.name));

                const filteredVeDich = filteredAllContest.filter(p => p.percentActual >= 100);
                const filteredCanCoGang = filteredAllContest.filter(p => p.percentActual >= 80 && p.percentActual < 100);
                const filteredCanTapTrung = filteredAllContest.filter(p => p.percentActual >= 50 && p.percentActual < 80);
                const filteredBaoDong = filteredAllContest.filter(p => p.percentActual < 50);

                const onTrackCount = filteredAllContest.filter(p => p.percentProjected >= 100).length;
                const totalCount = filteredAllContest.length;

                const now = new Date();
                const timeString = now.toLocaleTimeString('vi-VN');
                const ht = totalRow['% HT Target Ng√†y (Qƒê)'];
                const timeFraction = getTimePassedFraction();
                const projectedSales = timeFraction > 0 && timeFraction < 1 ? (totalRow['DT Realtime (Qƒê)'] / timeFraction) : totalRow['DT Realtime (Qƒê)'];
                const projectedHt = totalRow['Target Ng√†y (Qƒê)'] > 0 ? (projectedSales / totalRow['Target Ng√†y (Qƒê)'] * 100) : 0;
                const remaining = totalRow['Target Ng√†y (Qƒê)'] - totalRow['DT Realtime (Qƒê)'];

                const createSubListWithActual = (items) => {
                    if (!items || items.length === 0) return '';
                    return items.map(item => {
                        const missingText = item.remaining > 0 ? ` - Thi·∫øu: ${formatNumber(item.remaining)}` : '';
                        return `  - ${item.name} (${formatNumber(item.percentActual, 1)}%${missingText})`;
                    }).join('\n');
                };

                let contestSummarySections = [];

                if (totalCount > 0) {
                    contestSummarySections.push(`\n-------------------\nüèÅ T√åNH H√åNH THI ƒêUA (THEO ${totalCount} NG√ÄNH H√ÄNG) üèÅ`);

                    if (filteredVeDich.length > 0) {
                        contestSummarySections.push(`‚úÖ ƒê√É V·ªÄ ƒê√çCH (${filteredVeDich.length} nh√≥m):\n${createSubListWithActual(filteredVeDich)}`);
                    }
                    if (filteredCanCoGang.length > 0) {
                        contestSummarySections.push(`üí™ C·∫¶N C·ªê G·∫ÆNG (${filteredCanCoGang.length} nh√≥m - HT >80%):\n${createSubListWithActual(filteredCanCoGang)}`);
                    }
                    if (filteredCanTapTrung.length > 0) {
                        contestSummarySections.push(`üéØ C·∫¶N T·∫¨P TRUNG (${filteredCanTapTrung.length} nh√≥m - HT >50%):\n${createSubListWithActual(filteredCanTapTrung)}`);
                    }
                    if (filteredBaoDong.length > 0) {
                        contestSummarySections.push(`üö® B√ÅO ƒê·ªòNG (${filteredBaoDong.length} nh√≥m - HT <50%):\n${createSubListWithActual(filteredBaoDong)}`);
                    }
                } else {
                    contestSummarySections.push(`\n-------------------\nüèÅ T√åNH H√åNH THI ƒêUA üèÅ\nKh√¥ng c√≥ ng√†nh h√†ng n√†o ƒë∆∞·ª£c ch·ªçn trong b·ªô l·ªçc hi·ªán t·∫°i.`);
                }

                const summaryText = `üìä B√ÅO C√ÅO NHANH REAL-TIME - ${timeString} üìä
-------------------
- üéØ Target Ng√†y: ${formatNumber(totalRow['Target Ng√†y (Qƒê)'])}
- üìà Realtime: ${formatNumber(totalRow['DT Realtime (Qƒê)'])} (${formatNumber(ht, 1)}%)
- üìâ C√≤n l·∫°i: ${formatNumber(remaining)}
- üöÄ D·ª± ki·∫øn: ${formatNumber(projectedSales)} (${formatNumber(projectedHt, 1)}%)
- üèÜ Thi ƒëua d·ª± ki·∫øn ƒë·∫°t (Theo b·ªô l·ªçc): ${onTrackCount}/${totalCount}
-------------------
- üí≥ DT Tr·∫£ g√≥p: ${formatNumber(totalRow['DT Tr·∫£ G√≥p'])} (${formatNumber(totalRow['T·ª∑ tr·ªçng tr·∫£ g√≥p'], 1)}%)
- üì± S·ªë l∆∞·ª£ng b√°n: ${formatNumber(totalRow['S·ªë l∆∞·ª£ng'])}
${contestSummarySections.join('\n\n')}`.trim();

                const html = `<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                    <h2 style="margin: 0; margin-bottom: 0 !important;"><svg class="title-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M12,19L8,15H10.5V12H13.5V15H16L12,19Z" /></svg>Nh·∫≠n x√©t</h2>
                                    <button class="action-btn-small copySummaryBtn" style="display: flex; align-items: center; gap: 5px;">
                                        <svg fill="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" /></svg>
                                        Sao ch√©p
                                    </button>
                                 </div>
                                 <textarea class="summary-textarea" readonly>${summaryText}</textarea>`;
                container.innerHTML = html;
                container.querySelector('.copySummaryBtn').addEventListener('click', (e) => {
                    // Button is now inside a div header, textarea is the next sibling of that header div
                    const textarea = container.querySelector('.summary-textarea');
                    textarea.select();
                    document.execCommand('copy');
                    showToast('ƒê√£ sao ch√©p nh·∫≠n x√©t!');
                });
            }
        }
    </script>
</body>

</html>
